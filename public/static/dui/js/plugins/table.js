!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery"),require("template"),require("form"),require("popup"),require("pagination")):"function"==typeof define&&define.amd?define("table",["jquery","template","form","popup","pagination"],t):(e=e||self).table=t(e.jQuery,e.template,e.form,e.popup,e.pagination)}(this,function(m,y,e,c,g){"use strict";m=m&&m.hasOwnProperty("default")?m.default:m,y=y&&y.hasOwnProperty("default")?y.default:y,e=e&&e.hasOwnProperty("default")?e.default:e,c=c&&c.hasOwnProperty("default")?c.default:c,g=g&&g.hasOwnProperty("default")?g.default:g;function u(e){return['<table cellspacing="0" cellpadding="0" border="0" class="dui-table__header">',"<thead>","{{each columns  item1 i1}}","<tr>",(e=e||{}).fixed?"":"<% for(var i = 0; i < 3; i++){ %>","{{each item1 item2 i2}}",e.fixed&&"right"!==e.fixed?'<% if(item2.fixed && item2.fixed !== "right" && item2.colspan==1 && !item2.HAS_PARENT){ %>':e.fixed&&"right"===e.fixed?'<% if(item2.fixed && item2.fixed === "right" && item2.colspan==1 && !item2.HAS_PARENT){ %>':'<% if ((i==0 && item2.fixed && item2.fixed !== "right" && item2.colspan==1 && !item2.HAS_PARENT) || (i==1 && !item2.fixed) || (i==2 && item2.fixed && item2.fixed === "right" && item2.colspan==1 && !item2.HAS_PARENT)) { %>','<th{{if item2.minWidth}} data-minWidth="{{item2.minWidth}}"{{/if}}{{if item2.unresize || item2.colspan>1}} unresize="{{item2.unresize}}"{{/if}}','{{if item2.field}} data-field="{{item2.field}}"{{/if}}',' data-key="{{item2.key}}" colspan="{{item2.colspan}}" rowspan="{{item2.rowspan}}"',' class="{{if item2.sort && item2.colspan==1}}is-sortable{{/if}}{{if item2.type!=="normal"}} dui-table__cell-{{item2.type}}{{/if}}{{if item2.align}} is-{{item2.align}}{{/if}}">','<div class="cell dui-table-{{if item2.colGroup}}group{{else}}{{index}}-{{item2.key}}{{/if}}">','{{if item2.type=="checkbox"}}','<input type="checkbox" dui-checkbox indeterminate="true"{{if checkAll}} checked="checked"{{/if}} dui-filter="checkAll">',"{{else}}","{{item2.title}}","{{/if}}",'{{if item2.sort && item2.colspan==1 && item2.type!=="checkbox" && item2.type!=="numbers"}}','<span class="caret-wrapper{{if initSort && initSort.field==item2.field && initSort.sort=="desc"}} descending{{/if}}{{if initSort && initSort.field==item2.field && initSort.sort && initSort.sort!=="desc"}} ascending{{/if}}">','<i class="sort-caret ascending"></i>','<i class="sort-caret descending"></i>',"</span>","{{/if}}","</div>","</th>","<% } %>","{{/each}}",e.fixed?"":"<% } %>","</tr>","{{/each}}","</thead>","</table>"].join("")}function t(e){if(!e.el||!m(e.el)[0])throw new Error("初始化失败:没有获取到初始化元素");var t=new r(e);return d.call(t)}var n=m(window),h=(m(document),".dui-table__body-wrapper"),f=".dui-table__fixed-body-wrapper",p=".dui-table__body",i=".dui-table__body tr",a=".dui-table__fixed-header-wrapper",l=".dui-table__header",o=l+" th",s=".caret-wrapper",x="dui-table__expand-icon",b="dui-table__expand-icon--expanded",v='<div class="dui-table__empty-block"><div class="dui-table__empty-text">{{text}}</div></div>',w=1,d=function(){var e=this,t=this.config;return e.id=t.id||t.index,{config:t,getCheckedData:function(){return e.checkedData}}},r=function(e){var t=this,i=(t.state={init:!0},e=t.options=e,t.config=m.extend(!0,{el:"",columns:"",height:"",width:"",stripe:!1,border:!0,initSort:"",autoSort:!1,highlight:!0,loading:"",title:"",minColumnWidth:60,treeTable:"",data:"",done:"",text:"",request:"",response:""},e));if(t.where=i.where||{},i.el=m(i.el),!i.el[0])return t;i.height&&/^full-\d+$/.test(i.height)&&(t.fullHeightGap=i.height.split("-")[1],i.height=n.height()-t.fullHeightGap),i.text=m.extend({},{empty:"暂无数据",loadError:"ajax请求失败，请重试",loading:"数据加载中",notDataOrUrl:"没有设置数据或者url"},e.text),i.page=m.extend({},{show:!1,size:10,current:1,sizes:[10,20,30,40,50]},e.page),i.request=m.extend({pageName:"page",limitName:"size",sortName:"sort",whereName:"where"},e.request),i.response=m.extend({statusName:"code",statusCode:1,msgName:"msg",dataName:"data",countName:"count"},e.response),i.treeTable=!!i.treeTable&&m.extend(!0,{children:"children",keyColumn:"id",parentColumn:"pid",expandColumn:"",expandAll:!1},i.treeTable),t.currPage=parseInt(i.page.curr)||1,i.initSort?t.sortKey=m.extend(!0,{},i.initSort):t.sortKey={},t.init()};return r.prototype.init=function(){var e=this,t=e.config,i=t.el,d=i.next(".dui-table");t.columns,e.index=t.index=w++;e.initColumns();var r=y.render(['<div class="dui-table',"{{if border}} dui-table--border{{/if}}",'{{if highlight}} dui-table--enable-row-hover{{/if}}"',' dui-filter="dui-table-{{index}}-form"',' style="{{if height}}height:{{height}}px{{/if}}">','<div class="dui-table__header-wrapper">',u(),"</div>",'<div class="dui-table__body-wrapper{{if initScroll}} {{initScroll}}{{/if}}" style="height:{{bodyHeight}}px;">',"</div>","{{if fixedLCoumnsNum>0}}",'<div class="dui-table__fixed dui-table__fixed-left">','<div class="dui-table__fixed-header-wrapper">',u({fixed:"left"}),"</div>",'<div class="dui-table__fixed-body-wrapper" style="height:{{bodyHeight}}px;">',"</div>","</div>","{{/if}}","{{if fixedRCoumnsNum>0}}",'<div class="dui-table__fixed dui-table__fixed-right">','<div class="dui-table__fixed-header-wrapper">',u({fixed:"right"}),"</div>",'<div class="dui-table__fixed-body-wrapper" style="height:{{bodyHeight}} px;">',"</div>","</div>","{{/if}}","{{if page.show}}",'<div class="dui-table__page">',"</div>","{{/if}}",'<div class="dui-table__fixed-right-patch"></div>',"<style>","{{each columns  item1 i1}}","{{each item1 item2 i2}}","{{if item2.initWidth}}",".dui-table-{{index}}-{{item2.key}}{","width:{{item2.initWidth}}px;","}","{{/if}}","{{/each}}","{{/each}}","</style>","</div>"].join(""),t),n=e.reElem=m(r),a=e.duiHeader=n.find(".dui-table__header-wrapper"),l=(e.duiBodyer=n.find(h),e.duiFixed=n.find(".dui-table__fixed"),e.duiFixedL=n.find(".dui-table__fixed-left")),o=(e.duiFixedLWrap=l.find(f),e.duiFixedR=n.find(".dui-table__fixed-right"));e.duiFixedRWrap=o.find(f),e.duiPage=n.find(".dui-table__page"),e.duiGutter=m('<th class="gutter"><div class="cell"></div></th>'),e.duiPatch=n.find(".dui-table__fixed-right-patch"),e.duiLoading=c.loading({target:n[0]});d[0]&&d.remove(),i.after(n),e.fullSize(),a.find("th").each(function(e,t){var i=m(t).data("key");l.find('th[data-key="'+i+'"]').css("height",m(t).outerHeight()),o.find('th[data-key="'+i+'"]').css("height",m(t).outerHeight())}),e.renderForm(),e.pullData(e.currPage),e.setEvent();var s=setInterval(function(){0<e.duiBodyer.children().length&&(clearInterval(s),e.state.init=!1)},50)},r.prototype.initColumns=function(){var n=this.config.columns;m.each(n,function(r,t){m.each(t,function(i,e){if(e){if(e.colspan=0<parseInt(e.colspan)?parseInt(e.colspan):1,e.rowspan=0<parseInt(e.rowspan)?parseInt(e.rowspan):1,e.key="row"+r+"-col"+i,e.IsGroup||1<e.colspan){var d=0;m.each(n[r+1],function(e,t){t.HAS_PARENT||1<d&&d==t.colspan||(t.HAS_PARENT=!0,t.parentKey="row"+r+"-col"+i,d+=parseInt(1<t.colspan?t.colspan:1))}),e.colGroup=!0}!function(e){var t={checkbox:48,space:15,numbers:40};e.type||t[e.type]||(e.type="normal"),"normal"!==e.type&&(e.unresize=!0,e.width=e.width||t[e.type])}(e)}else t.splice(i,1)})}),this.initColumnsWidth()},r.prototype.getClientWidth=function(){var r=this.config;return r.clientWidth=r.width||function e(t){var i,d;i=(t=t||r.el.parent()).width();try{d="none"===t.css("display")}catch(e){}return!t[0]||i&&!d?i:e(t.parent())}(),r.clientWidth},r.prototype.fullSize=function(){var e,t=this,i=t.config,d=i.height;t.duiHeader.height();t.fullHeightGap&&((d=n.height()-t.fullHeightGap)<135&&(d=135),t.reElem.css("height",d)),t.fixedHeight=t.reElem.height(),d&&(e=parseFloat(d)-(t.duiHeader.outerHeight()||48),i.page.show&&(e=t.bodyHeight=e-(t.duiPage.outerHeight()||41)-2,t.fixedHeight=t.reElem.height()-(t.duiPage.outerHeight()||41)),t.duiBodyer.css("height",e))},r.prototype.setFixedStyle=function(){var e=this,t=e.duiBodyer.height(),i=e.getScrollHeight(e.duiBodyer[0]),d=(e.getScrollWidth(e.duiBodyer[0]),e.duiFixedL.find(a).width()),r=e.duiFixedR.find(a).width(),n=e.duiHeader.height();e.duiFixed.css("height",e.fixedHeight-(i||1)),e.duiFixedL.css("width",d),e.duiFixedR.css("width",r),e.duiFixed.find(f).css({height:t-i,top:n}),0==i?e.duiFixed.css("display","none"):e.duiFixed.css("display","")},r.prototype.initColumnsWidth=function(){var e=this,n=e.config,r=0,a=0,l=0,o=0,s=e.getClientWidth(),c=(n.fixedLCoumnsNum=0,n.fixedRCoumnsNum=0,0);e.eachColumns(function(e,t){var i,d;t.hide||(i=0,d=t.minWidth||n.minColumnWidth,i=t.width||d,/\d+%$/.test(i)&&(i=Math.floor(parseFloat(i)/100*s))<d&&(i=d),c+=i),t.hide||r++}),n.initScroll=s<c?"is-scrolling-left":"is-scrolling-none",s-=n.border?r+1:0;function t(r){e.eachColumns(function(e,t){var i=0,d=t.minWidth||n.minColumnWidth;t.colGroup||t.hide||(r?l&&l<d&&(a--,i=d):(i=t.width||0,/\d+%$/.test(i)?(i=Math.floor(parseFloat(i)/100*s))<d&&(i=d):i||(t.width=i=0,a++)),t.hide&&(i=0),(o+=i)<s&&a&&(l=(s-o)/a))},!0)}t(),t(!0),a=0,e.eachColumns(function(e,t){var i=t.minWidth||n.minColumnWidth;t.minWidth=i,t.colGroup||t.hide||(0===t.width?(t.initWidth=Math.floor(i<=l?l:i),t.autoColumn=!0,a++):/\d+%$/.test(t.width)?t.initWidth=Math.floor(parseFloat(t.width)/100*s):t.initWidth=t.width,t.fixed&&"right"!==t.fixed?n.fixedLCoumnsNum++:t.fixed&&"right"===t.fixed&&n.fixedRCoumnsNum++)},!0),n.autoColNums=a},r.prototype.resColumnsWidth=function(){var i=this,e=i.config,d=i.getScrollWidth(i.duiBodyer[0]),t=e.autoColNums,r=0,n=parseFloat(d/t);i.eachColumns(function(e,t){t.colGroup||t.hide||(r++,t.autoColumn&&(t.subtract&&0==d?(t.subtract=!1,i.getCssRule(t.key,function(e){e.style.width=parseFloat(e.style.width)+t.subtractWidth+"px"})):!t.subtract&&0<d&&(t.subtract=!0,t.subtractWidth=n,i.getCssRule(t.key,function(e){e.style.width=parseFloat(e.style.width)-n+"px"}))))},!0);var a=i.duiBodyer.width()-i.getScrollWidth(i.duiBodyer[0])-i.duiBodyer.children("table").outerWidth();if(t&&-r<=a&&a<=r){var l=function e(t){return!(t=t||i.duiHeader.eq(0).find("thead th:last-child")).data("field")&&t.prev()[0]?e(t.prev()):t}(),o=l.data("key");i.getCssRule(o,function(e){var t=e.style.width||l.outerWidth();e.style.width=parseFloat(t)+a+"px",0<i.duiBodyer.height()-i.duiBodyer.prop("clientHeight")&&(e.style.width=parseFloat(e.style.width)-1+"px")})}},r.prototype.getScrollWidth=function(e){var t=0;return e?t=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),t},r.prototype.getScrollHeight=function(e){var t=0;return e?t=e.offsetHeight-e.clientHeight:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowX="scroll",document.body.appendChild(e),t=e.offsetHeight-e.clientHeight,document.body.removeChild(e)),t},r.prototype.setScrollPatch=function(){var e=this,t=e.config,i=e.duiBodyer.children("table"),d=e.getScrollWidth(e.duiBodyer[0]),r=e.getScrollHeight(e.duiBodyer[0]),n=e.duiBodyer.prop("offsetWidth")-i.outerWidth(),a=d<n?n:d;0<d?(e.duiHeader.find("thead>tr").eq(0).append(e.duiGutter),1<t.columns.length&&e.gutter.attr("rowspan",t.columns.length),e.duiFixedR.css({right:d}),e.duiPatch.css({width:d,height:e.duiHeader.height()})):e.duiFixedR.css({right:""}),0<r||a?(e.duiGutter.css("width",a),e.duiGutter.css("display","block")):e.duiGutter.css("display","none")},r.prototype.eachColumns=function(d,r){var e=this.config,n=m.extend(!0,[],e.columns),a=[],l=0;m.each(n,function(t,e){m.each(e,function(e,i){if(i.colGroup){var d=0;l++,i.CHILD_COLS=[],m.each(n[t+1],function(e,t){t.PARENT_COL_INDEX||1<d&&d==i.colspan||(t.PARENT_COL_INDEX=l,i.CHILD_COLS.push(t),d+=parseInt(1<t.colspan?t.colspan:1))})}i.PARENT_COL_INDEX||a.push(i)})});var o=function(i){var d;return m.each(e.columns,function(e,t){m.each(t,function(e,t){t.key!=i.key||(d=t)})}),d};!function i(e){m.each(e||a,function(e,t){if(t.CHILD_COLS)return i(t.CHILD_COLS);t=r?o(t):t,"function"==typeof d&&d(e,t)})}()},r.prototype.getCssRule=function(i,d){var r=this,e=r.reElem.find("style")[0],t=e.sheet||e.styleSheet||{},n=t.cssRules||t.rules;m.each(n,function(e,t){if(t.selectorText===".dui-table-"+r.index+"-"+i)return d(t),!0})},r.prototype.renderForm=function(){e.render(this.reElem)},r.prototype.pullData=function(e){var t=this,i=t.config,d=i.request,r=i.response,n=i.data,a=t.buildRequest();if(t.startTime=(new Date).getTime(),i.loading&&t.duiLoading.show(),n.url)i.treeTable||(a[d.pageName]=e,a[d.limitName]=i.page.size),n.contentType&&0==n.contentType.indexOf("application/json")&&(a=JSON.stringify(a)),m.ajax({url:n.url,type:n.type||"get",contentType:n.contentType,data:a,dataType:"json",headers:i.data.headers||{},success:function(e){e[r.statusName]===r.statusCode?(t.renderData(e,a[d.pageName],e[r.countName]),t.consumingTime=(new Date).getTime()-t.startTime):t.duiBodyer.html(y.render(v,{text:i.text.loadError}))},error:function(){t.duiBodyer.html(y.render(v,{text:i.text.loadError})),t.duiLoading.close()}});else if(i.data&&i.data.constructor===Array){var l={},o=i.page.limit,s=e*o-o,c=JSON.parse(JSON.stringify(i.data))||[];a.sort&&a.sort.field&&(c=dui.sort(c,a.sort.field,a.sort.sort?a.sort.sort:"asc")),l[r.dataName]=c.concat().splice(s,o),l[r.countName]=c.length,t.renderData(l,e,c.length)}else t.duiBodyer.html(y.render(v,{text:i.text.notDataOrUrl}))},r.prototype.renderData=function(e,n,t){var a,l,o,s,c,u,d,i=this,h=i.config,r=(h.columns,e[h.response.dataName]||[]),f='<table cellspacing="0" cellpadding="0" border="0" class="dui-table__body"><tbody></tbody></table>';if(h.treeTable){h.page.show=!1;var p=new dui.jsTree({child:h.treeTable.children,id:h.treeTable.keyColumn,pid:h.treeTable.parentColumn});r=p.toList(r)}if(!0===h.page.show&&g.render(m.extend(!0,h,{el:i.duiPage[0],total:t,size:h.page.size,current:i.currPage,jump:function(e){i.currPage=e.page,h.page.size=e.size,i.pullData(i.currPage)}})),0==r.length)return i.renderForm(),i.duiFixedLWrap.html(""),i.duiFixedRWrap.html(""),i.duiBodyer.html(""),void i.duiBodyer.html(y.render(v,{text:h.text.empty}));a=[],l=[],o=[],s=m(f),c=m(f),u=m(f),d=['<td dui-field="{{field}}" class="{{if align}} is-{{align}}{{/if}}{{if type!=="normal"}} dui-table__cell-{{type}}{{/if}}" dui-key="{{key}}"{{if style}} style="{{style}}"{{/if}}>','<div class="cell dui-table-{{stylekey}}">',"{{if template}}{{@ template}}","{{else}}",'{{if type=="checkbox"}}','<input type="checkbox" value="{{@ fieldName}}"{{if checkAll}} checked="checked"{{/if}} dui-checkbox>','{{else if type=="numbers"}}',"{{@ duiIndex}}","{{else}}",function(){if(h.treeTable)return['{{if field=="'+h.treeTable.expandColumn+'"}}','<span class="dui-table__row--level_#{#level#}#" style="padding-left:#{#(level-1)*16#}#px">',"#{#if hasChild#}#",'<span class="dui-table__expand-icon#{#if '+h.treeTable.expandAll+' || expand #}# dui-table__expand-icon--expanded#{#/if#}#">','<i class="'+(h.treeTable.expandIcon?h.treeTable.expandIcon:" dui-icon-arrow-right")+'"></i>',"</span>","#{#else#}#",'<span class="dui-table__placeholder"></span>',"#{#/if#}#","</span>","{{/if}}"].join("")}(),"{{@ fieldName}}","{{/if}}","{{/if}}","</div>","</td>"].join(""),i.eachColumns(function(e,t){t.stylekey=h.index+"-"+t.key,t.fieldName="{{"+t.field+"}}",t.duiIndex="{{duiIndex}}";var i=y.render(d,t).replace(/#{#/g,"{{").replace(/#}#/g,"}}");t.fixed&&"right"!==t.fixed?a.push(i):t.fixed&&"right"===t.fixed?o.push(i):l.push(i)}),l=a.concat(l).concat(o),m.each(r,function(e,t){t.duiIndex=((n||1)-1)*h.page.size+e+1;var i=0<a.length?m("<tr >"+y.render(a.join(""),t)+"</tr>"):"",d=0<o.length?m("<tr >"+y.render(o.join(""),t)+"</tr>"):"",r=0<l.length?m("<tr >"+y.render(l.join(""),t)+"</tr>"):"";i[0]&&(i[0].data=t),d[0]&&(d[0].data=t),r[0]&&(r[0].data=t),h.treeTable&&(h.treeTable.expandAll||t.expand||0==t[h.treeTable.parentColumn]?(r.css("display",""),i.css("display",""),d.css("display","")):(r.css("display","none"),i.css("display","none"),d.css("display","none"))),s.append(r),c.append(i),u.append(d)}),i.duiBodyer.scrollTop(0),i.duiBodyer.html(""),i.duiBodyer.append(s),i.duiFixedLWrap.html(""),i.duiFixedLWrap.append(c),i.duiFixedRWrap.html(""),i.duiFixedRWrap.append(u),i.renderForm(),i.fullSize(),i.resColumnsWidth(),i.setFixedStyle(),i.setScrollPatch(),i.duiLoading.close()},r.prototype.setEvent=function(){var a,c=this,u=c.config,e=c.reElem.find(o),d=m("body"),r={};e.on("click",function(e){var t,i=m(this),d=i.find(s),r=i.data("field"),n=c.sortKey.sort;if(!d[0]||1===a)return a=2;t="desc"===n?null:"asc"===n?"desc":"asc",c.sort(r,t)}).find(s+" .sort-caret").on("click",function(e){var t=m(this),i=t.index(),d=t.parents("th").eq(0).data("field");e.stopPropagation(),0===i?c.sort(d,"asc"):c.sort(d,"desc")}),c.reElem.on("click",".dui-checkbox",function(e){var t=m(this),i=t.find("input[dui-checkbox]"),d=i.parents("tr")[0].data,r=c.reElem.find(p).find("input[dui-checkbox]"),o=i[0].checked;if(void 0!==i.attr("indeterminate"))o=!!t.hasClass("is-checked")||!!t.hasClass("is-indeterminate"),r.each(function(e,t){t.checkboxClass?t.checkboxClass.setChecked(o):(o?m(t).attr("checked","checked"):m(t).removeAttr("checked"),c.renderForm())}),c.synCheckedAll();else{if(c.reElem.find(p).find("tr").each(function(e,t){t.data.duiIndex==d.duiIndex&&m(t).find("input[dui-checkbox]").each(function(e,t){t&&t!=i[0]&&(t.checkboxClass?t.checkboxClass.setChecked(o):(o?m(t).attr("checked","checked"):m(t).removeAttr("checked"),c.renderForm()))})}),u.treeTable){var s=[];c.duiBodyer.find(p).find("input[dui-checkbox]:checked").parents("tr").each(function(e,t){s.push(t.data.duiIndex)}),AllSyn=[].concat(function r(n){var a=[],l=c.duiBodyer.find(p).find("tr");return l.each(function(e,t){if(t.data&&t.data[u.treeTable.keyColumn]==n[u.treeTable.parentColumn]){if(0==o){var i=m.extend(!0,{},t.data[u.treeTable.children]),d=!1;if(m.each(i,function(e,t){n[u.treeTable.keyColumn]==t[u.treeTable.keyColumn]&&delete i[e]}),m.each(i,function(e,i){m.each(l,function(e,t){i[u.treeTable.keyColumn]!=t.data[u.treeTable.keyColumn]||(i=t.data,-1==m.inArray(i.duiIndex,s))||(d=!0)})}),d)return}-1==m.inArray(t.data.duiIndex,a)&&a.push(t.data.duiIndex),t.data[u.treeTable.parentColumn]&&(a=a.concat(r(t.data)))}}),a}(d)).concat(function i(e){var d=[],t=c.duiBodyer.find(p).find("tr"),r=(e[u.treeTable.children]||[]).map(function(e,t){return e[u.treeTable.keyColumn]});return t.each(function(e,t){t.data&&-1!=m.inArray(t.data[u.treeTable.keyColumn],r)&&(d.push(t.data.duiIndex),t.data.hasChild&&(d=d.concat(i(t.data))))}),d}(d)),c.reElem.find(p).find("tr").each(function(e,t){-1!=m.inArray(t.data.duiIndex,AllSyn)&&m(t).find("input[dui-checkbox]").each(function(e,t){t&&t!=i[0]&&(t.checkboxClass?t.checkboxClass.setChecked(o):(o?m(t).attr("checked","checked"):m(t).removeAttr("checked"),c.renderForm()))})})}c.synCheckedAll()}}),c.duiBodyer.on("scroll",function(){c.synScroll()}),n.on("resize",function(e){c.resize()}),c.reElem.on("mouseenter",i,function(){var e=m(this).index();c.reElem.find(p).find("tr:eq("+e+")").addClass("hover-row")}).on("mouseleave",i,function(){var e=m(this).index();c.reElem.find(p).find("tr:eq("+e+")").removeClass("hover-row")}),e.on("mousemove",function(e){var t=m(this),i=t.offset().left,d=e.clientX-i;"true"===t.attr("unresize")||r.resizeStart||(r.allowResize=t.width()-d<=10,t.css("cursor",r.allowResize?"col-resize":""))}).on("mouseleave",function(e){var t=m(this);r.resizeStart||t.css("cursor","")}).on("mousedown",function(e){var i=m(this);if(r.allowResize){var t=i.data("key");e.preventDefault(),r.resizeStart=!0,r.offset=[e.clientX,e.clientY],c.getCssRule(t,function(e){var t=e.style.width||i.outerWidth();r.rule=e,r.ruleWidth=parseFloat(t),r.minWidth=i.data("minwidth")||u.minColumnWidth}),d.css("cursor","col-resize")}}),d.on("mousemove",function(e){if(r.resizeStart){if(e.preventDefault(),r.rule){var t=r.ruleWidth+e.clientX-r.offset[0];t<r.minWidth&&(t=r.minWidth),r.rule.style.width=t+"px"}a=1,c.setFixedStyle(),c.setScrollPatch(),c.renderFixedShadow()}}).on("mouseup",function(e){r.resizeStart&&(r={},d.css("cursor","")),2===a&&(a=null)}),c.reElem.on("click","."+x,function(e){var t=m(this),i=t.parents("tr"),r=!!t.hasClass(b),d=i[0].data.hasChild?i[0].data[u.treeTable.children]:[],n=c.reElem.find(p+" tbody>tr");r?t.removeClass(b):t.addClass(b),n.each(function(e,t){!function i(d,e){m.each(e,function(e,t){d.data[u.treeTable.keyColumn]==t[u.treeTable.keyColumn]?r?(m(d).css("display","none"),d.data.hasChild&&m(d).find("."+x).removeClass(b)):m(d).css("display",""):r&&t.hasChild&&i(d,t[u.treeTable.children])})}(t,d)}),c.resColumnsWidth()})},r.prototype.sort=function(e,t){var i,d=this,r=(d.config,d.reElem.find(o+'[data-field="'+e+'"]'));0!=r.length&&(d.sortKey.field==e&&d.sortKey.sort==t||(e&&d.sortKey.field!=e&&(t="asc"),d.sortKey={field:e,sort:t},null===t&&(d.sortKey={}),r.siblings().find(s).attr("class","caret-wrapper"),i="asc"==t?"caret-wrapper ascending":"desc"==t?"caret-wrapper descending":"caret-wrapper",r.find(s).attr("class",i),d.pullData(d.currPage)))},r.prototype.resize=function(){this.fullSize(),this.resColumnsWidth(),this.setFixedStyle(),this.setScrollPatch(),this.renderFixedShadow()},r.prototype.renderFixedShadow=function(){var e=this.duiBodyer,t=this.getScrollWidth(e[0]),i=e.prop("offsetHeight")-e.prop("clientHeight"),d=e.find("table").width()-e.width(),r=e.scrollLeft();0==i?e.attr("class",h.slice(1,h.length)+" is-scrolling-none"):r==d+t?e.attr("class",h.slice(1,h.length)+" is-scrolling-right"):0<r&&r<d+t?e.attr("class",h.slice(1,h.length)+" is-scrolling-middle"):0==r&&e.attr("class",h.slice(1,h.length)+" is-scrolling-left")},r.prototype.synCheckedAll=function(){var d=this,e=(d.config,d.duiBodyer.find("input[dui-checkbox]")),t=d.duiBodyer.find("input[dui-checkbox]:checked"),i=d.reElem.find(l).find('input[dui-checkbox][dui-filter="checkAll"]'),r=!1;r=e.length==t.length||0!=t.length&&"indeterminate",i.each(function(e,t){t.checkboxClass?t.checkboxClass.setChecked(r):(m(t).attr("state","indeterminate"),d.renderForm())}),d.checkedData=[],t.parents("tr").each(function(e,t){var i=m.extend(!0,{},t.data);delete i.duiIndex,d.checkedData.push(i)})},r.prototype.synScroll=function(){var e=this.duiBodyer,t=e.scrollLeft(),i=e.scrollTop();this.duiHeader.scrollLeft(t),this.duiFixed.find(f).scrollTop(i),this.renderFixedShadow()},r.prototype.buildRequest=function(){var e=this.config.request,t=this.where,i=this.sortKey,d={};return i&&(d[e.sortName]=i),t&&(d[e.whereName]=t),d},t.render=function(e){return t(e)},t.init=function(){},t});