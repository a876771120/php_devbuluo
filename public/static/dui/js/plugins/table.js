!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery"),require("template"),require("form"),require("popup"),require("pagination")):"function"==typeof define&&define.amd?define("table",["jquery","template","form","popup","pagination"],t):(e=e||self).table=t(e.jQuery,e.template,e.form,e.popup,e.pagination)}(this,function(b,m,o,y,v){"use strict";b=b&&b.hasOwnProperty("default")?b.default:b,m=m&&m.hasOwnProperty("default")?m.default:m,o=o&&o.hasOwnProperty("default")?o.default:o,y=y&&y.hasOwnProperty("default")?y.default:y,v=v&&v.hasOwnProperty("default")?v.default:v;function c(e){return['<table cellspacing="0" cellpadding="0" border="0" class="dui-table__header">',"<thead>","{{each columns  item1 i1}}","<tr>",(e=e||{}).fixed?"":"<% for(var i = 0; i < 3; i++){ %>","{{each item1 item2 i2}}",e.fixed&&"right"!==e.fixed?'<% if(item2.fixed && item2.fixed !== "right" && item2.colspan==1 && !item2.HAS_PARENT){ %>':e.fixed&&"right"===e.fixed?'<% if(item2.fixed && item2.fixed === "right" && item2.colspan==1 && !item2.HAS_PARENT){ %>':'<% if ((i==0 && item2.fixed && item2.fixed !== "right" && item2.colspan==1 && !item2.HAS_PARENT) || (i==1 && !item2.fixed) || (i==2 && item2.fixed && item2.fixed === "right" && item2.colspan==1 && !item2.HAS_PARENT)) { %>','<th{{if item2.minWidth}} data-minWidth="{{item2.minWidth}}"{{/if}}{{if item2.unresize || item2.colspan>1}} unresize="{{item2.unresize}}"{{/if}}','{{if item2.field}} data-field="{{item2.field}}"{{/if}}',' data-key="{{item2.key}}" colspan="{{item2.colspan}}" rowspan="{{item2.rowspan}}"',' class="{{if item2.sort && item2.colspan==1}}is-sortable{{/if}}{{if item2.type!=="normal"}} dui-table__cell-{{item2.type}}{{/if}}{{if item2.align}} is-{{item2.align}}{{/if}}">','<div class="cell dui-table-{{if item2.colGroup}}group{{else}}{{index}}-{{item2.key}}{{/if}}">','{{if item2.type=="checkbox"}}','<input type="checkbox" dui-checkbox indeterminate="true"{{if checkAll}} checked="checked"{{/if}} dui-filter="checkAll">',"{{else}}","{{item2.title||item2.field}}","{{/if}}",'{{if item2.sort && item2.colspan==1 && item2.type!=="checkbox" && item2.type!=="numbers"}}','<span class="caret-wrapper{{if initSort && initSort.field==item2.field && initSort.sort=="desc"}} descending{{/if}}{{if initSort && initSort.field==item2.field && initSort.sort && initSort.sort!=="desc"}} ascending{{/if}}">','<i class="sort-caret ascending"></i>','<i class="sort-caret descending"></i>',"</span>","{{/if}}","</div>","</th>","<% } %>","{{/each}}",e.fixed?"":"<% } %>","</tr>","{{/each}}","</thead>","</table>"].join("")}function t(e){if(!e.el||!b(e.el)[0])throw new Error("初始化失败:没有获取到初始化元素");var t=new d(e);return a.call(t)}var n=b(window),g=(b(document),{eq:"等于",neq:"不等于",gt:"大于",gte:"大于等于",lt:"小于",lte:"小于等于",contain:"包含",notContain:"不包含",between:"介于"}),x={integer:["eq","neq","gt","gte","lt","lte","contain","notContain","between"],float:["eq","neq","gt","gte","lt","lte","contain","notContain","between"],timestamp:["gt","gte","lt","lte","between"],boolean:["eq","neq"],string:["contain","notContain","eq","neq"],enum:["eq","neq"]},u=".dui-table__body-wrapper",h=".dui-table__fixed-body-wrapper",f=".dui-table__body",i=".dui-table__body tr",r=".dui-table__fixed-header-wrapper",l=".dui-table__header",s=l+" th",p=".caret-wrapper",_="dui-table__expand-icon",w="dui-table__expand-icon--expanded",C='<div class="dui-table__empty-block"><div class="dui-table__empty-text">{{text}}</div></div>',k=1,a=function(){var t=this,e=this.config;return t.id=e.id||e.index,{config:e,getCheckedData:function(){return t.checkedData},search:function(e){return t.search(e)},showFilterForm:function(){t.filterForm.show()},hideFilterForm:function(){t.filterForm.hide()}}},d=function(e){var t=this,i=(t.state={init:!0},e=t.options=e,t.config=b.extend(!0,{el:"",columns:"",height:"",width:"",stripe:!1,border:!0,initSort:"",autoSort:!1,highlight:!0,loading:!0,title:"",minColumnWidth:60,treeTable:"",data:"",done:"",text:"",request:"",response:""},e));if(t.where=i.where||{},i.el=b(i.el),i.original=b(i.el),!i.el[0])return t;i.height&&/^full-\d+$/.test(i.height)&&(t.fullHeightGap=i.height.split("-")[1],i.height=n.height()-t.fullHeightGap),i.text=b.extend({},{empty:"暂无数据",loadError:"ajax请求失败，请重试",loading:"数据加载中",notDataOrUrl:"没有设置数据或者url"},e.text),i.page=b.extend({},{show:!1,size:10,current:1,sizes:[10,20,30,40,50]},e.page),i.request=b.extend({pageName:"page",limitName:"size",sortName:"sort",whereName:"where",filterDataName:"filterData"},e.request),i.response=b.extend({statusName:"code",statusCode:1,msgName:"msg",dataName:"data",countName:"count"},e.response),i.treeTable=!!i.treeTable&&b.extend(!0,{children:"children",keyColumn:"id",parentColumn:"pid",expandColumn:"",expandAll:!1},i.treeTable),t.currPage=parseInt(i.page.curr)||1,i.initSort?t.sortKey=b.extend(!0,{},i.initSort):t.sortKey={},t.init()};return d.prototype.init=function(){var e=this,t=e.config,i=t.el,a=i.next(".dui-table");t.columns,e.index=t.index=k++;e.initColumns();var d=m.render(['<div class="dui-table',"{{if border}} dui-table--border{{/if}}",'{{if highlight}} dui-table--enable-row-hover{{/if}}"',' dui-filter="dui-table-{{index}}-form"',' style="{{if height}}height:{{height}}px{{/if}}">','<div class="dui-table__box">','<div class="dui-table__header-wrapper">',c(),"</div>",'<div class="dui-table__body-wrapper{{if initScroll}} {{initScroll}}{{/if}}" style="height:{{bodyHeight}}px;">',"</div>","{{if fixedLCoumnsNum>0}}",'<div class="dui-table__fixed dui-table__fixed-left">','<div class="dui-table__fixed-header-wrapper">',c({fixed:"left"}),"</div>",'<div class="dui-table__fixed-body-wrapper" style="height:{{bodyHeight}}px;">',"</div>","</div>","{{/if}}","{{if fixedRCoumnsNum>0}}",'<div class="dui-table__fixed dui-table__fixed-right">','<div class="dui-table__fixed-header-wrapper">',c({fixed:"right"}),"</div>",'<div class="dui-table__fixed-body-wrapper" style="height:{{bodyHeight}} px;">',"</div>","</div>","{{/if}}",'<div class="dui-table__fixed-right-patch"></div>',"</div>","{{if page.show}}",'<div class="dui-table__page">',"</div>","{{/if}}","{{if filterArr.length>0}}",'<div class="dui-table__condition">','<div class="dui-table__condition-label">高级查询</div>','<div class="dui-table__condition-body">','<div class="dui-table__condition-body-inner">','<div class="dui-table__condition-items"></div>',"</div>","</div>","</div>","{{/if}}","<style>","{{each columns  item1 i1}}","{{each item1 item2 i2}}","{{if item2.initWidth}}",".dui-table-{{index}}-{{item2.key}}{","width:{{item2.initWidth}}px;","}","{{/if}}","{{/each}}","{{/each}}","</style>","</div>"].join(""),t),n=e.reElem=b(d),r=(e.duiTableBox=n.find(".dui-table__box"),e.duiHeader=n.find(".dui-table__header-wrapper")),l=(e.duiBodyer=n.find(u),e.duiFixed=n.find(".dui-table__fixed"),e.duiFixedL=n.find(".dui-table__fixed-left")),o=(e.duiFixedLWrap=l.find(h),e.duiFixedR=n.find(".dui-table__fixed-right"));e.duiFixedRWrap=o.find(h),e.duiPage=n.find(".dui-table__page"),e.duiGutter=b('<th class="gutter"><div class="cell"></div></th>'),e.duiPatch=n.find(".dui-table__fixed-right-patch"),e.duiLoading=y.loading({target:n[0]});(e.duiCondition=n.find(".dui-table__condition"))[0]&&e.initFilter(),a[0]&&a.remove(),i.after(n),e.fullSize(),r.find("th").each(function(e,t){var i=b(t).data("key");l.find('th[data-key="'+i+'"]').css("height",b(t).outerHeight()+1),o.find('th[data-key="'+i+'"]').css("height",b(t).outerHeight()+1)}),e.renderForm(),e.pullData(e.currPage),e.setEvent();var s=setInterval(function(){0<e.duiBodyer.children().length&&(clearInterval(s),e.state.init=!1)},50)},d.prototype.initFilter=function(){function e(){var h=this;h.events={addCondition:function(e){var t,i=b(this);t=i.parents(l)[0]?i.parents(l).next().children("ul"):i.parents(m).next("ul");var a=b(['<li class="dui-table__filter-item" data-id="'+n+++'" data-prefix="and" data-field="'+r.field+'" data-mod="condition" data-type="'+r.type+'" data-condition="'+x[r.type][0]+'" data-value="">','<div class="dui-table__filter-item-content">','<div class="dui-table__filter-item-prefix">','<input type="checkbox" dui-switch value="and" active-value="and" inactive-value="or" active-text="且" inactive-text="或" skin="label-in" width="43" inactive-color="#67c23a">',"</div>",'<div class="dui-table__filter-item-field">','<label filter-event="fieldChange" class="dui-firebrick">'+r.title+"</label>","</div>",'<div class="dui-table__filter-item-condition">','<label filter-event="conditionChange" class="dui-deeppink">'+g[x[r.type][0]]+"</label>","</div>",'<div class="dui-table__filter-item-value">','<label filter-event="valueChange" class="dui-blueviolet">'+("enum"==r.type?"请选择...":"请输入...")+"</label>","</div>",'<div class="dui-table__filter-item-delete">','<label filter-event="deletItem"><i class="dui-icon-circle-close"></i></label>',"</div>","</div>","</li>"].join(""));a.find('input[type="checkbox"]')[0].onchange=function(e){var t=b(this).val();a.attr("data-prefix",t),f.sysFilterForm()},o.render(a),t.append(a),f.sysFilterForm()},addGroup:function(e){var t,i=b(this);t=i.parents(l)[0]?i.parents(l).next().children("ul"):i.parents(m).next("ul");var a=b(['<li class="dui-table__filter-item"  data-id="'+n+++'" data-mod="group" data-prefix="and">','<div class="dui-table__filter-item-content">','<div class="dui-table__filter-item-prefix">','<input type="checkbox" dui-switch value="and" active-value="and" inactive-value="or" active-text="且" inactive-text="或" skin="label-in" width="43" inactive-color="#67c23a">',"</div>",'<div class="dui-table__filter-item-field">','<label class="dui-firebrick">分组</label>',"</div>",'<div class="dui-table__filter-item-operation">','<div class="dui-button-group">','<button class="dui-button dui-button--primary dui-button--mini" filter-event="addCondition">添加条件</button>','<button class="dui-button dui-button--primary dui-button--mini" filter-event="addGroup">添加分组</button>',"</div>","</div>",'<div class="dui-table__filter-item-delete">','<label filter-event="deletItem"><i class="dui-icon-circle-close"></i></label>',"</div>","</div>",'<ul class="dui-table__filter-item-group">',"</ul>","</li>"].join(""));a.find('input[type="checkbox"]')[0].onchange=function(e){var t=b(this).val();a.attr("data-prefix",t),f.sysFilterForm()},o.render(a),t.append(a),f.sysFilterForm()},deletItem:function(e){b(this).parents(m).parent().remove(),f.sysFilterForm()},fieldChange:function(e){var i,o=b(this),s=o.parents(m).parent("li");if(this.popverDom&&"none"!==b(this.popverDom).css("display"))this.hide();else{var a=s.attr("data-field"),t=b(['<ul class="dui-select-dropdown__list">',(i="",b.each(d.filterArr,function(e,t){i+='<li class="dui-select-dropdown__item'+(a==t.field?" selected":"")+'" dui-field="'+t.field+'"><span>'+t.title+"</span></li>"}),i),"</ul>"].join(""));t.on("click",".dui-select-dropdown__item",function(e){var t=b(this);if(!t.hasClass("selected")){var i=t.attr("dui-field"),a=p[i].title,d=p[i].type,n=x[d][0],r=g[n];t.addClass("selected").siblings().removeClass("selected"),s.attr("data-field",i),s.attr("data-type",d),s.attr("data-condition",n),s.attr("data-value",""),s.children().find(c+">label").text(a),s.children().find(u+">label").text(r);var l=-1!=b.inArray(d,["enum","timestamp"])?"请选择...":"请输入...";s.children().find(v+">label").text(l),o[0].hide(),f.sysFilterForm()}}),h.events.showPopover(this,t[0])}},conditionChange:function(e){var i,d=b(this),n=d.parents(m).parent("li");if(this.popverDom&&"none"!==b(this.popverDom).css("display"))this.hide();else{var r=n.attr("data-type"),a=n.attr("data-condition"),t=x[r],l=b(['<ul class="dui-select-dropdown__list">',(i="",b.each(t,function(e,t){i+='<li class="dui-select-dropdown__item'+(a==t?" selected":"")+'" dui-condition="'+t+'"><span>'+g[t]+"</span></li>"}),i),"</ul>"].join(""));l.on("click",".dui-select-dropdown__item",function(e){var t=b(this);if(!t.hasClass("selected")){var i=t.attr("dui-condition");t.addClass("selected").siblings().removeClass("selected"),n.attr("data-condition",i),n.attr("data-value",""),n.children().find(u+">label").text(g[i]);var a=-1!=b.inArray(r,["enum","timestamp"])?"请选择...":"请输入...";n.children().find(v+">label").text(a),d[0].hide(),f.sysFilterForm()}}),h.events.showPopover(this,l[0])}},valueChange:function(e){var t,i,a,d=b(this),n=d.parents(m).parent("li");if(this.popverDom&&"none"!==b(this.popverDom).css("display"))this.hide&&this.hide();else{var r=n.attr("data-field"),l=n.attr("data-type"),o=n.attr("data-condition"),s=n.attr("data-value");if("enum"==l||"boolean"==l){var c="boolean"==l?{true:"true",false:"false"}:p[r].options;(u=b(['<ul class="dui-select-dropdown__list">',(a="",b.each(c,function(e,t){a+='<li class="dui-select-dropdown__item'+(s==e&&c[s]?" selected":"")+'" dui-value="'+e+'"><span>'+t+"</span></li>"}),a),"</ul>"].join(""))).on("click",".dui-select-dropdown__item",function(e){var t=b(this);if(!t.hasClass("selected")){var i=t.attr("dui-value");t.addClass("selected").siblings().removeClass("selected"),n.attr("data-value",i),n.children().find(v+">label").text(c[i]),d[0].hide(),f.sysFilterForm()}}),h.events.showPopover(this,u[0])}else if("timestamp"==l);else if("between"==o){var u=b(['<div class="dui-range-editor dui-input__inner dui-range-editor--mini">','<input autocomplete="off" placeholder="开始值" name="" class="dui-range-input" value="'+(i=s.split(","),2==i.length?i[0]:"")+'">','<span class="dui-range-separator">到</span>','<input autocomplete="off" placeholder="结束值" name="" class="dui-range-input" value="'+(t=s.split(","),2==t.length?t[1]:"")+'">',"</div>"].join(""));d.hide(),d.after(u),u.find("input").eq(0).focus(),u.find("input").on("blur",function(e){setTimeout(function(){var e=u.find("input");if(!u.find("input").is(":focus")){if(!e.eq(0).val())return y.message("请输入开始值",{type:"error"}),void e.eq(0).focus();if(!e.eq(1).val())return y.message("请输入结束值",{type:"error"}),void e.eq(1).focus();var t=[e.eq(0).val(),e.eq(1).val()];n.attr("data-value",t.join(",")),n.children().find(v+">label").text(t?t.join(" 到 "):"请输入..."),d.show(),u.remove(),f.sysFilterForm()}},30)})}else{u=b(['<div class="dui-input dui-input--mini">','<input type="text" class="dui-input__inner" placeholder="请输入..." value="'+s+'">',"</div>"].join(""));d.hide(),d.after(u),u.children("input").focus().on("blur",function(e){var t=b(this).val();n.attr("data-value",t),n.children().find(v+">label").text(t||"请输入..."),d.show(),u.remove(),f.sysFilterForm()})}}},showPopover:function(t,e){var i=b(['<div class="dui-popper dui-popver dui-table__popver" style="display:none">','<div x-arrow="" class="popper__arrow"></div>',"</div>"].join(""));i.prepend(e);var a={top:"bottom",bottom:"top"};t.popverDom=i[0],b("body").append(i),i[0].visible="none"==i.css("display"),i[0].popver=dui.addPopper(t,i[0],{placement:"bottom-center",onCreate:function(e){i[0].transition=dui.transition(i[0],{name:"dui-zoom-in-"+a[e._options.placement.split("-")[0]],enter:function(){i[0].popver.updatePopper()},afterLeave:function(){i.remove(),t.hide=void 0,t.popverDom=void 0}})},onUpdate:function(e){i[0].transition.data.name="dui-zoom-in-"+a[e.placement.split("-")[0]]}}),i[0].show=function(){b("body").append(i),i[0].visible=!1,i[0].transition.show()},i[0].hide=t.hide=function(){i[0].visible=!0,i[0].transition.hide()},i[0].show()}},h.Allcondition=g,h.condition=x;var e=h.formDom=b(['<div class="dui-table__filterForm">','<div class="dui-table__filterForm-toolbar">','<div class="dui-button-group dui-col-xs6">','<button class="dui-button dui-button--primary dui-button--small" filter-event="addCondition">添加条件</button>','<button class="dui-button dui-button--primary dui-button--small" filter-event="addGroup">添加分组</button>',"</div>",'<div class="dui-col-xs6 dui-table__filterFrom-toolbar-op">','<input type="checkbox" dui-checkbox="" id="auto_search" bordered="true" label="实时更新">','<button class="dui-button dui-button--primary dui-button--small" id="filter_search">查询</button>',"</div>","</div>",'<div class="dui-table__filterForm-body">',"<ul></ul>","</div>","</div>"].join(""));e.find("#auto_search")[0].onchange=function(e){f.sysFilterForm(!0)},dui.on(e.find("#filter_search")[0],"click",function(e){f.sysFilterForm(!0)}),o.render(e[0])}var f=this,d=f.config,n=1,t=d.filterArr,p=d.filterObj,r=t[0],l=".dui-table__filterForm-toolbar",m=".dui-table__filter-item-content",c=".dui-table__filter-item-field",u=".dui-table__filter-item-condition",v=".dui-table__filter-item-value";e.prototype.show=function(e){var i=this;b(i.formDom).on("click","[filter-event]",function(e){var t=b(this).attr("filter-event");i.events&&i.events[t]&&i.events[t].call(this,e)}),i.popup=y.dialog({title:"高级查询",content:i.formDom[0],showFooter:!1,width:460,height:400})},e.prototype.hide=function(){this.popup&&this.popup.close()},f.filterForm=new e},d.prototype.sysFilterForm=function(e){var t=this,i=t.config,a=t.filterForm.formDom,p=(i.filterArr,i.filterObj),m={and:"且",or:"或"},d=".dui-table__filterForm-toolbar",n=".dui-table__filterForm-body>ul",v=".dui-table__filter-item-value>label",r=".dui-table__condition-body-inner";if(a.find(d).find("#auto_search").is(":checked")||e){var l=a.find(n),o=function h(e){var t=e.children("li"),f="";return t.each(function(e,t){var i=b(t),a=i.attr("data-id"),d=i.attr("data-mod"),n=i.attr("data-prefix"),r=i.attr("data-field"),l=i.attr("data-type"),o=i.attr("data-condition"),s=i.attr("data-value"),c=i.find(v).text();if("group"==i.attr("data-mod")){var u=i.children("ul");0<u.children("li").length&&(f+=['<div class="dui-table__condition-item" data-id="'+a+'" data-prefix="'+n+'">',""!=f?'<div class="dui-table__condition-prefix dui-red">'+m[n]+"</div>":"",h(u),"</div>"].join(""))}else f+=['<div class="dui-table__condition-item" data-id="'+a+'" data-prefix="'+n+'" data-field="'+r+'" ','data-mod="'+d+'" data-type="'+l+'" data-condition="'+o+'" data-value="'+s+'">',""!=f?'<div class="dui-table__condition-prefix dui-red">'+m[n]+"</div>":"",'<div class="dui-table__condition-field dui-firebrick">'+p[r].title+"</div>",'<div class="dui-table__condition-condition dui-deeppink">'+g[o]+"</div>",'<div class="dui-table__condition-value dui-blueviolet">'+c+"</div>","</div>"].join("")}),f}(l),s=t.filterData=function u(e){var t=e.children("li"),h=[];return t.each(function(e,t){var i=b(t),a=(i.attr("data-id"),i.attr("data-mod")),d=i.attr("data-prefix"),n=i.attr("data-field"),r=i.attr("data-type"),l=i.attr("data-condition"),o=i.attr("data-value");if("group"==i.attr("data-mod")){var s=i.children("ul");if(0<s.children("li").length){var c={};0<h.length&&(c.prefix=d),c.mod=a,c.children=u(s),h.push(c)}}else{c={};0<h.length&&(c.prefix=d),c.mod=a,c.field=n,c.condition=l,c.type=r,c.value=o,h.push(c)}}),h}(l);b(t.reElem).find(r).children("div").html(o),0<s.length&&t.pullData(1)}},d.prototype.initColumns=function(){var e=this.config,r=e.columns,l={},o=[];b.each(r,function(d,n){b.each(n,function(i,e){if(e){if(e.colspan=0<parseInt(e.colspan)?parseInt(e.colspan):1,e.rowspan=0<parseInt(e.rowspan)?parseInt(e.rowspan):1,e.key="row"+d+"-col"+i,e.IsGroup||1<e.colspan){var a=0;b.each(r[d+1],function(e,t){t.HAS_PARENT||1<a&&a==t.colspan||(t.HAS_PARENT=!0,t.parentKey="row"+d+"-col"+i,a+=parseInt(1<t.colspan?t.colspan:1))}),e.colGroup=!0}if(e.filter){var t=b.extend(!0,{},e.filter);t.type||(t.type="string"),t.title||(t.title=e.title||e.field),t.field=e.field,l[e.field]=t,o.push(t)}!function(e){var t={checkbox:48,space:15,numbers:40};e.type||t[e.type]||(e.type="normal"),"normal"!==e.type&&(e.unresize=!0,e.width=e.width||t[e.type])}(e)}else n.splice(i,1)})}),e.filterObj=l,e.filterArr=o,this.initColumnsWidth()},d.prototype.getClientWidth=function(){var d=this.config;return d.clientWidth=d.width||function e(t){var i,a;i=(t=t||d.el.parent()).width();try{a="none"===t.css("display")}catch(e){}return!t[0]||i&&!a?i:e(t.parent())}(),d.clientWidth},d.prototype.fullSize=function(){var e,t=this,i=t.config,a=i.height;t.duiHeader.height();t.fullHeightGap&&((a=n.height()-t.fullHeightGap)<135&&(a=135),t.reElem.css("height",a)),t.fixedHeight=t.duiTableBox.height(),a&&(e=parseFloat(a)-(t.duiHeader.outerHeight()||48),i.page.show&&(e=t.bodyHeight=e-(t.duiPage.outerHeight()||41)-2),0<i.filterArr.length&&(e=t.bodyHeight=e-(t.duiPage.outerHeight()||41)-2),t.duiBodyer.css("height",e))},d.prototype.setFixedStyle=function(){var e=this,t=e.duiBodyer.height(),i=e.getScrollHeight(e.duiBodyer[0]),a=(e.getScrollWidth(e.duiBodyer[0]),e.duiFixedL.find(r).width()),d=e.duiFixedR.find(r).width(),n=e.duiHeader.height();e.duiFixed.css("height",e.fixedHeight-(i||1)),e.duiFixedL.css("width",a),e.duiFixedR.css("width",d),e.duiFixed.find(h).css({height:t-i,top:n+1}),0==i?e.duiFixed.css("display","none"):e.duiFixed.css("display","")},d.prototype.initColumnsWidth=function(){var e=this,n=e.config,d=0,r=0,l=0,o=0,s=e.getClientWidth(),c=(n.fixedLCoumnsNum=0,n.fixedRCoumnsNum=0,0);e.eachColumns(function(e,t){var i,a;t.hide||(i=0,a=t.minWidth||n.minColumnWidth,i=t.width||a,/\d+%$/.test(i)&&(i=Math.floor(parseFloat(i)/100*s))<a&&(i=a),c+=i),t.hide||d++}),n.initScroll=s<c?"is-scrolling-left":"is-scrolling-none",s-=n.border?d+1:0;function t(d){e.eachColumns(function(e,t){var i=0,a=t.minWidth||n.minColumnWidth;t.colGroup||t.hide||(d?l&&l<a&&(r--,i=a):(i=t.width||0,/\d+%$/.test(i)?(i=Math.floor(parseFloat(i)/100*s))<a&&(i=a):i||(t.width=i=0,r++)),t.hide&&(i=0),(o+=i)<s&&r&&(l=(s-o)/r))},!0)}t(),t(!0),r=0,e.eachColumns(function(e,t){var i=t.minWidth||n.minColumnWidth;t.minWidth=i,t.colGroup||t.hide||(0===t.width?(t.initWidth=Math.floor(i<=l?l:i),t.autoColumn=!0,r++):/\d+%$/.test(t.width)?t.initWidth=Math.floor(parseFloat(t.width)/100*s):t.initWidth=t.width,t.fixed&&"right"!==t.fixed?n.fixedLCoumnsNum++:t.fixed&&"right"===t.fixed&&n.fixedRCoumnsNum++)},!0),n.autoColNums=r},d.prototype.resColumnsWidth=function(){var i=this,e=i.config,a=i.getScrollWidth(i.duiBodyer[0]),t=e.autoColNums,d=0,n=parseFloat(a/t);i.eachColumns(function(e,t){t.colGroup||t.hide||(d++,t.autoColumn&&(t.subtract&&0==a?(t.subtract=!1,i.getCssRule(t.key,function(e){e.style.width=parseFloat(e.style.width)+t.subtractWidth+"px"})):!t.subtract&&0<a&&(t.subtract=!0,t.subtractWidth=n,i.getCssRule(t.key,function(e){e.style.width=parseFloat(e.style.width)-n+"px"}))))},!0);var r=i.duiBodyer.width()-i.getScrollWidth(i.duiBodyer[0])-i.duiBodyer.children("table").outerWidth();if(t&&-d<=r&&r<=d){var l=function e(t){return!(t=t||i.duiHeader.eq(0).find("thead th:last-child")).data("field")&&t.prev()[0]?e(t.prev()):t}(),o=l.data("key");i.getCssRule(o,function(e){var t=e.style.width||l.outerWidth();e.style.width=parseFloat(t)+r+"px",0<i.duiBodyer.height()-i.duiBodyer.prop("clientHeight")&&(e.style.width=parseFloat(e.style.width)-1+"px")})}},d.prototype.getScrollWidth=function(e){var t=0;return e?t=e.offsetWidth-e.clientWidth:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowY="scroll",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth,document.body.removeChild(e)),t},d.prototype.getScrollHeight=function(e){var t=0;return e?t=e.offsetHeight-e.clientHeight:((e=document.createElement("div")).style.width="100px",e.style.height="100px",e.style.overflowX="scroll",document.body.appendChild(e),t=e.offsetHeight-e.clientHeight,document.body.removeChild(e)),t},d.prototype.setScrollPatch=function(){var e=this,t=e.config,i=e.duiBodyer.children("table"),a=e.getScrollWidth(e.duiBodyer[0]),d=e.getScrollHeight(e.duiBodyer[0]),n=e.duiBodyer.prop("offsetWidth")-i.outerWidth(),r=a<n?n:a;0<a?(e.duiHeader.find("thead>tr").eq(0).append(e.duiGutter),1<t.columns.length&&e.gutter.attr("rowspan",t.columns.length),e.duiFixedR.css({right:a}),e.duiPatch.css({width:a,height:e.duiHeader.height()})):e.duiFixedR.css({right:""}),0<d||r?(e.duiGutter.css("width",r),e.duiGutter.css("display","block")):e.duiGutter.css("display","none")},d.prototype.eachColumns=function(a,d){var e=this.config,n=b.extend(!0,[],e.columns),r=[],l=0;b.each(n,function(t,e){b.each(e,function(e,i){if(i.colGroup){var a=0;l++,i.CHILD_COLS=[],b.each(n[t+1],function(e,t){t.PARENT_COL_INDEX||1<a&&a==i.colspan||(t.PARENT_COL_INDEX=l,i.CHILD_COLS.push(t),a+=parseInt(1<t.colspan?t.colspan:1))})}i.PARENT_COL_INDEX||r.push(i)})});var o=function(i){var a;return b.each(e.columns,function(e,t){b.each(t,function(e,t){t.key!=i.key||(a=t)})}),a};!function i(e){b.each(e||r,function(e,t){if(t.CHILD_COLS)return i(t.CHILD_COLS);t=d?o(t):t,"function"==typeof a&&a(e,t)})}()},d.prototype.getCssRule=function(i,a){var d=this,e=d.reElem.find("style")[0],t=e.sheet||e.styleSheet||{},n=t.cssRules||t.rules;b.each(n,function(e,t){if(t.selectorText===".dui-table-"+d.index+"-"+i)return a(t),!0})},d.prototype.renderForm=function(){o.render(this.reElem)},d.prototype.pullData=function(e){var t=this,i=t.config,a=i.request,d=i.response,n=i.data,r=t.buildRequest();if(t.startTime=(new Date).getTime(),i.loading&&t.duiLoading.show(),n.url)i.treeTable||(r[a.pageName]=e,r[a.limitName]=i.page.size),n.contentType&&0==n.contentType.indexOf("application/json")&&(r=JSON.stringify(r)),b.ajax({url:n.url,type:n.type||"get",contentType:n.contentType,data:r,dataType:"json",headers:i.data.headers||{},success:function(e){e[d.statusName]===d.statusCode?(t.renderData(e,r[a.pageName],e[d.countName]),t.consumingTime=(new Date).getTime()-t.startTime):t.duiBodyer.html(m.render(C,{text:i.text.loadError}))},error:function(){t.duiBodyer.html(m.render(C,{text:i.text.loadError})),t.duiLoading.close()}});else if(i.data&&i.data.constructor===Array){var l={},o=i.page.limit,s=e*o-o,c=JSON.parse(JSON.stringify(i.data))||[];r.sort&&r.sort.field&&(c=dui.sort(c,r.sort.field,r.sort.sort?r.sort.sort:"asc")),l[d.dataName]=c.concat().splice(s,o),l[d.countName]=c.length,t.renderData(l,e,c.length)}else t.duiBodyer.html(m.render(C,{text:i.text.notDataOrUrl}))},d.prototype.renderData=function(e,n,t){var r,l,o,s,c,u,a,i=this,h=i.config,d=(h.columns,e[h.response.dataName]||[]),f='<table cellspacing="0" cellpadding="0" border="0" class="dui-table__body"><tbody></tbody></table>';if(h.treeTable){h.page.show=!1;var p=new dui.jsTree({child:h.treeTable.children,id:h.treeTable.keyColumn,pid:h.treeTable.parentColumn});d=p.toList(d)}!0===h.page.show&&v.render(b.extend(!0,{},h,{el:i.duiPage[0],total:t,size:h.page.size,current:i.currPage,jump:function(e){i.currPage=e.page,h.page.size=e.size,i.pullData(i.currPage)}})),0==d.length?(i.renderForm(),i.duiFixedLWrap.html(""),i.duiFixedRWrap.html(""),i.duiBodyer.html(""),i.duiBodyer.html(m.render(C,{text:h.text.empty})),i.duiPage.hide()):(r=[],l=[],o=[],s=b(f),c=b(f),u=b(f),a=['<td dui-field="{{field}}" class="{{if align}} is-{{align}}{{/if}}{{if type!=="normal"}} dui-table__cell-{{type}}{{/if}}" dui-key="{{key}}"{{if style}} style="{{style}}"{{/if}}>','<div class="cell dui-table-{{stylekey}}">',"{{if template}}{{@ template}}","{{else}}",'{{if type=="checkbox"}}','<input type="checkbox" value="{{@ fieldName}}"{{if checkAll}} checked="checked"{{/if}} dui-checkbox>','{{else if type=="numbers"}}',"{{@ duiIndex}}","{{else}}",function(){if(h.treeTable)return['{{if field=="'+h.treeTable.expandColumn+'"}}','<span class="dui-table__row--level_#{#level#}#" style="padding-left:#{#(level-1)*16#}#px">',"#{#if hasChild#}#",'<span class="dui-table__expand-icon#{#if '+h.treeTable.expandAll+' || expand #}# dui-table__expand-icon--expanded#{#/if#}#">','<i class="'+(h.treeTable.expandIcon?h.treeTable.expandIcon:" dui-icon-arrow-right")+'"></i>',"</span>","#{#else#}#",'<span class="dui-table__placeholder"></span>',"#{#/if#}#","</span>","{{/if}}"].join("")}(),"{{@ fieldName}}","{{/if}}","{{/if}}","</div>","</td>"].join(""),i.eachColumns(function(e,t){t.stylekey=h.index+"-"+t.key,t.fieldName="{{"+t.field+"}}",t.duiIndex="{{duiIndex}}";var i=m.render(a,t).replace(/#{#/g,"{{").replace(/#}#/g,"}}");t.fixed&&"right"!==t.fixed?r.push(i):t.fixed&&"right"===t.fixed?o.push(i):l.push(i)}),l=r.concat(l).concat(o),b.each(d,function(e,t){t.duiIndex=((n||1)-1)*h.page.size+e+1;var i=0<r.length?b("<tr >"+m.render(r.join(""),t)+"</tr>"):"",a=0<o.length?b("<tr >"+m.render(o.join(""),t)+"</tr>"):"",d=0<l.length?b("<tr >"+m.render(l.join(""),t)+"</tr>"):"";i[0]&&(i[0].data=t),a[0]&&(a[0].data=t),d[0]&&(d[0].data=t),h.treeTable&&(h.treeTable.expandAll||t.expand||0==t[h.treeTable.parentColumn]?(d.css("display",""),i.css("display",""),a.css("display","")):(d.css("display","none"),i.css("display","none"),a.css("display","none"))),s.append(d),c.append(i),u.append(a)}),i.duiBodyer.scrollTop(0),i.duiBodyer.html(""),i.duiBodyer.append(s),i.duiFixedLWrap.html(""),i.duiFixedLWrap.append(c),i.duiFixedRWrap.html(""),i.duiFixedRWrap.append(u),i.renderForm(),i.fullSize(),i.resColumnsWidth(),i.setFixedStyle(),i.setScrollPatch(),i.duiPage.show()),i.duiLoading.close()},d.prototype.setEvent=function(){var r,c=this,u=c.config,e=c.reElem.find(s),a=b("body"),d={};e.on("click",function(e){var t,i=b(this),a=i.find(p),d=i.data("field"),n=c.sortKey.sort;if(!a[0]||1===r)return r=2;t="desc"===n?null:"asc"===n?"desc":"asc",c.sort(d,t)}).find(p+" .sort-caret").on("click",function(e){var t=b(this),i=t.index(),a=t.parents("th").eq(0).data("field");e.stopPropagation(),0===i?c.sort(a,"asc"):c.sort(a,"desc")}),c.reElem.on("click",".dui-checkbox",function(e){var t=b(this),i=t.find("input[dui-checkbox]"),a=i.parents("tr")[0].data,d=c.reElem.find(f).find("input[dui-checkbox]"),o=i[0].checked;if(void 0!==i.attr("indeterminate"))o=!!t.hasClass("is-checked")||!!t.hasClass("is-indeterminate"),d.each(function(e,t){t.checkboxClass?t.checkboxClass.setChecked(o):(o?b(t).attr("checked","checked"):b(t).removeAttr("checked"),c.renderForm())}),c.synCheckedAll();else{if(c.reElem.find(f).find("tr").each(function(e,t){t.data.duiIndex==a.duiIndex&&b(t).find("input[dui-checkbox]").each(function(e,t){t&&t!=i[0]&&(t.checkboxClass?t.checkboxClass.setChecked(o):(o?b(t).attr("checked","checked"):b(t).removeAttr("checked"),c.renderForm()))})}),u.treeTable){var s=[];c.duiBodyer.find(f).find("input[dui-checkbox]:checked").parents("tr").each(function(e,t){s.push(t.data.duiIndex)}),AllSyn=[].concat(function d(n){var r=[],l=c.duiBodyer.find(f).find("tr");return l.each(function(e,t){if(t.data&&t.data[u.treeTable.keyColumn]==n[u.treeTable.parentColumn]){if(0==o){var i=b.extend(!0,{},t.data[u.treeTable.children]),a=!1;if(b.each(i,function(e,t){n[u.treeTable.keyColumn]==t[u.treeTable.keyColumn]&&delete i[e]}),b.each(i,function(e,i){b.each(l,function(e,t){i[u.treeTable.keyColumn]!=t.data[u.treeTable.keyColumn]||(i=t.data,-1==b.inArray(i.duiIndex,s))||(a=!0)})}),a)return}-1==b.inArray(t.data.duiIndex,r)&&r.push(t.data.duiIndex),t.data[u.treeTable.parentColumn]&&(r=r.concat(d(t.data)))}}),r}(a)).concat(function i(e){var a=[],t=c.duiBodyer.find(f).find("tr"),d=(e[u.treeTable.children]||[]).map(function(e,t){return e[u.treeTable.keyColumn]});return t.each(function(e,t){t.data&&-1!=b.inArray(t.data[u.treeTable.keyColumn],d)&&(a.push(t.data.duiIndex),t.data.hasChild&&(a=a.concat(i(t.data))))}),a}(a)),c.reElem.find(f).find("tr").each(function(e,t){-1!=b.inArray(t.data.duiIndex,AllSyn)&&b(t).find("input[dui-checkbox]").each(function(e,t){t&&t!=i[0]&&(t.checkboxClass?t.checkboxClass.setChecked(o):(o?b(t).attr("checked","checked"):b(t).removeAttr("checked"),c.renderForm()))})})}c.synCheckedAll()}}),c.duiBodyer.on("scroll",function(){c.synScroll()}),n.on("resize",function(e){c.resize()}),c.reElem.on("mouseenter",i,function(){var e=b(this).index();c.reElem.find(f).find("tr:eq("+e+")").addClass("hover-row")}).on("mouseleave",i,function(){var e=b(this).index();c.reElem.find(f).find("tr:eq("+e+")").removeClass("hover-row")}),e.on("mousemove",function(e){var t=b(this),i=t.offset().left,a=e.clientX-i;"true"===t.attr("unresize")||d.resizeStart||(d.allowResize=t.width()-a<=10,t.css("cursor",d.allowResize?"col-resize":""))}).on("mouseleave",function(e){var t=b(this);d.resizeStart||t.css("cursor","")}).on("mousedown",function(e){var i=b(this);if(d.allowResize){var t=i.data("key");e.preventDefault(),d.resizeStart=!0,d.offset=[e.clientX,e.clientY],c.getCssRule(t,function(e){var t=e.style.width||i.outerWidth();d.rule=e,d.ruleWidth=parseFloat(t),d.minWidth=i.data("minwidth")||u.minColumnWidth}),a.css("cursor","col-resize")}}),a.on("mousemove",function(e){if(d.resizeStart){if(e.preventDefault(),d.rule){var t=d.ruleWidth+e.clientX-d.offset[0];t<d.minWidth&&(t=d.minWidth),d.rule.style.width=t+"px"}r=1,c.setFixedStyle(),c.setScrollPatch(),c.renderFixedShadow()}}).on("mouseup",function(e){d.resizeStart&&(d={},a.css("cursor","")),2===r&&(r=null)}),c.reElem.on("click","."+_,function(e){var t=b(this),i=t.parents("tr"),d=!!t.hasClass(w),a=i[0].data.hasChild?i[0].data[u.treeTable.children]:[],n=c.reElem.find(f+" tbody>tr");d?t.removeClass(w):t.addClass(w),n.each(function(e,t){!function i(a,e){b.each(e,function(e,t){a.data[u.treeTable.keyColumn]==t[u.treeTable.keyColumn]?d?(b(a).css("display","none"),a.data.hasChild&&b(a).find("."+_).removeClass(w)):b(a).css("display",""):d&&t.hasChild&&i(a,t[u.treeTable.children])})}(t,a)}),c.resColumnsWidth()}),c.reElem.on("click",".dui-table__condition-label",function(e){c.filterForm.show()}),b(document).on("click",function(d){b("body").find(".dui-table__popver").each(function(e,t){var i=b(t),a=b(d.target);i[0]==a[0]||i.find(d.target)[0]||"none"!==i.css("display")&&i[0].hide&&i[0].hide()})})},d.prototype.sort=function(e,t){var i,a=this,d=(a.config,a.reElem.find(s+'[data-field="'+e+'"]'));0!=d.length&&(a.sortKey.field==e&&a.sortKey.sort==t||(e&&a.sortKey.field!=e&&(t="asc"),a.sortKey={field:e,sort:t},null===t&&(a.sortKey={}),d.siblings().find(p).attr("class","caret-wrapper"),i="asc"==t?"caret-wrapper ascending":"desc"==t?"caret-wrapper descending":"caret-wrapper",d.find(p).attr("class",i),a.pullData(a.currPage)))},d.prototype.resize=function(){this.fullSize(),this.resColumnsWidth(),this.setFixedStyle(),this.setScrollPatch(),this.renderFixedShadow()},d.prototype.renderFixedShadow=function(){var e=this.duiBodyer,t=this.getScrollWidth(e[0]),i=e.prop("offsetHeight")-e.prop("clientHeight"),a=e.find("table").width()-e.width(),d=e.scrollLeft();0==i?e.attr("class",u.slice(1,u.length)+" is-scrolling-none"):d==a+t?e.attr("class",u.slice(1,u.length)+" is-scrolling-right"):0<d&&d<a+t?e.attr("class",u.slice(1,u.length)+" is-scrolling-middle"):0==d&&e.attr("class",u.slice(1,u.length)+" is-scrolling-left")},d.prototype.synCheckedAll=function(){var a=this,e=(a.config,a.duiBodyer.find("input[dui-checkbox]")),t=a.duiBodyer.find("input[dui-checkbox]:checked"),i=a.reElem.find(l).find('input[dui-checkbox][dui-filter="checkAll"]'),d=!1;d=e.length==t.length||0!=t.length&&"indeterminate",i.each(function(e,t){t.checkboxClass?t.checkboxClass.setChecked(d):(b(t).attr("state","indeterminate"),a.renderForm())}),a.checkedData=[],t.parents("tr").each(function(e,t){var i=b.extend(!0,{},t.data);delete i.duiIndex,a.checkedData.push(i)})},d.prototype.synScroll=function(){var e=this.duiBodyer,t=e.scrollLeft(),i=e.scrollTop();this.duiHeader.scrollLeft(t),this.duiFixed.find(h).scrollTop(i),this.renderFixedShadow()},d.prototype.search=function(e){this.where=e,this.pullData(1)},d.prototype.refreshresData=function(){this.pullData(this.currPage)},d.prototype.buildRequest=function(){var e=this.config.request,t=this.where,i=this.sortKey,a=this.filterData,d={};return i&&(d[e.sortName]=i),t&&(d[e.whereName]=t),a&&(d[e.filterDataName]=JSON.stringify(a)),d},t.render=function(e){return t(e)},t.init=function(){},t});