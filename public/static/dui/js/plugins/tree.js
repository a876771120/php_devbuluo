!function(e,d){"object"==typeof exports&&"undefined"!=typeof module?module.exports=d(require("jquery"),require("form")):"function"==typeof define&&define.amd?define("tree",["jquery","form"],d):(e=e||self).tree=d(e.jQuery,e.form)}(this,function(h,l){"use strict";h=h&&h.hasOwnProperty("default")?h.default:h,l=l&&l.hasOwnProperty("default")?l.default:l;function n(e){var d=this,n=d.config=h.extend(!0,{el:"",name:"",idName:"id",childName:"children",showCheckbox:!1,accordion:!1,indent:16,iconClass:"",showLine:!1,checkeds:[],expandeds:[],expandAll:!1,checkedAll:!1,data:[]},e);if(d.options=e,d.el=h(n.el),h.isArray(n.data))d.data=h.extend(!0,[],n.data),d.render();else if(!n.data||!n.data.url)return void console.error("数据源类型错误！")}function d(e){if(!e.el||!h(e.el)[0])throw new Error("初始化失败:没有获取到初始化元素");var d=new n(e);return i.call(d)}var u="dui-tree-node__content",i=function(){var e=this;return{config:e.config,getCheckedData:function(){return e.getCheckedData()}}};return n.prototype.render=function(){var e=this,d=e.data,n=e.config,i=e.view(d,1);e.el.html("").addClass("dui-tree"),e.inner=h(i),e.el.append(e.inner),l.render(e.el[0],"checkbox"),e.checkeds=h.extend(!0,[],n.checkeds),e.dataList=e.layerToList(d),e.evens()},n.prototype.layerToList=function(e,d){var t=this.config;return function n(e,i){var a={};return e=JSON.parse(JSON.stringify(e)),h.each(e,function(e,d){d.pid=i,(a[d[t.idName]]=d)[t.childName]&&h.isArray(d[t.childName])&&Object.assign(a,n(d[t.childName],d[t.idName]))}),a}(e,d=d||0)},n.prototype.getCheckedData=function(){var e=this,n=e.config,d=h.extend(!0,{},e.dataList),i=[],a=[];return e.el.find("input[dui-checkbox]:checked").parents(".dui-checkbox").parent().each(function(e,d){i.push(h(d).data("key"))}),h.each(d,function(e,d){-1!==h.inArray(d[n.idName],i)&&(delete d[n.childName],delete d.pid,a.push(d))}),a},n.prototype.view=function(e,i){var a=this,t=a.config,c="";return h.each(e,function(e,d){var n=['<div class="dui-tree-node'+(d.expanded||-1!=h.inArray(d[t.idName],t.expanded)||t.expandAll?" is-expanded":"")+'">','<div class="dui-tree-node__content" data-key="'+d[t.idName]+'" style="padding-left:'+(i-1)*t.indent+'px">','<i class="dui-tree-node__expand-icon dui-icon-arrow-right'+(d[t.childName]?"":" is-leaf")+'"></i>',function(){if(t.showCheckbox)return['<input type="checkbox"'+(t.name?' value="'+d[t.idName]+'" name="'+t.name+'[]"':"")+" dui-checkbox"+(d.checked||-1!=h.inArray(d[t.idName],t.checkeds)||t.checkedAll?' checked="checked"':""),d.disabled?' disabled="disabled"':"",">"].join("")}(),'<span class="dui-tree-node__label">'+d.label+"</span>","</div>",d[t.childName]&&h.isArray(d[t.childName])?'<div class="dui-tree-node__children" '+(d.expanded||-1!=h.inArray(d[t.idName],t.expandeds)||t.expandAll?'style="display:block"':'style="display:none"')+">"+a.view(d[t.childName],i+1)+"</div>":"","</div>"].join("");c+=n}),c},n.prototype.evens=function(){var o=this,s=o.config;o.el.find(".dui-tree-node").on("click",function(e){e.stopPropagation();var d=h(this),n=d.hasClass("is-expanded"),i=d.children("."+u).find(".dui-tree-node__expand-icon"),a=d.children(".dui-tree-node__children");n?(a.hide(300),i.removeClass("expanded"),d.removeClass("is-expanded")):(a.show(300),i.addClass("expanded"),d.addClass("is-expanded"))}).find(".dui-checkbox").on("click",function(e){e.stopPropagation();var d=h(this),n=d.parent().data("key"),i=o.dataList[n],a=i[s.childName]||[],t=d.find("input[dui-checkbox]"),r=t[0].checked,c=[].concat(function n(e){var i=[];h.each(e,function(e,d){d.disabled&&!d[s.childName]||i.push(d[s.idName]),d[s.childName]&&(i=i.concat(n(d[s.childName])))});return i}(a)).concat(function e(n){var i=[],a=[];o.el.find("input[dui-checkbox]:checked").parents(".dui-checkbox").parent().each(function(e,d){a.push(h(d).data("key"))});var d=o.dataList[n.pid],t=!1;if(d){if(0==r){var c=h.extend(!0,{},d[s.childName]);h.each(c,function(e,d){d[s.idName]==n[s.idName]&&delete c[e]}),h.each(c,function(e,d){if(-1!==h.inArray(d[s.idName],a))return t=!0,i})}t||(i.push(d[s.idName]),d.pid&&(i=i.concat(e(d))))}return i}(i));o.el.find("."+u).each(function(e,d){var n=h(this),i=n.data("key"),a=n.children(".dui-checkbox").find("input[dui-checkbox]");-1!==h.inArray(i,c)&&(a[0].checkboxClass?a[0].checkboxClass.setChecked(r):(r?(h(t).attr("checked","checked"),h(a).attr("checked","checked")):(h(a).removeAttr("checked"),h(t).removeAttr("checked")),l.render(o.el[0],"checkbox")))})})},d.render=function(e){return d(e)},d});